# stellite android http, quic sample application

<!-- TOC -->

- [stellite android http, quic sample application](#stellite-android-http-quic-sample-application)
    - [Outline](#Outline)
    - [Build libstellite_http_client.so](#libstellite_http_clientso-를-빌드)
    - [Create NDK enabled Android project](#ndk-사용설정된-android-project-생성)
    - [Copy libstellite_http_client.so](#libstellite_http_clientso-를-복사)
    - [Copy jar files built from chromium](#chromium-에서-빌드된-jar-파일들-복사)
    - [Write NDK build scripts](#ndk-빌드스크립트-작성)
    - [Write satellite initialization codes](#stellite-초기화-코드-작성)
    - [Write satellite quic request/response codes](#stetlite-quic-요청응답-코드-작성)
    - [Check the results through logcat](#logcat으로-결과확인)

<!-- /TOC -->

## Outline
- Example of using satellite with NDK's jni binding in Android
- Click button to request/response https://www.google.co.kr:443 using the QUIC protocol.
- Check request/response confirmation through logcat.

## Build libstellite_http_client.so
- https://github.com/line/stellite/blob/master/BUILD.md

```bash
./tools/build.py --target-platform=android --target stellite_http_client --target-type shared_library build
```

- 180518 When there is a slight change on the current chromium build dependency and causes build to fail, some manual patching would be required.
    - https://github.com/line/stellite/issues/58


## Create NDK enabled Android project
- Create using basic ndk template in Android studio.

## Copy libstellite_http_client.so
- When you navigate to an Android targeted build path, you will find so files generated by each architecture.
- From here, copy armeabi-v7a only to make a simple sample. 

```bash
./build_android/src/out_android_armv6/obj/libstellite_http_client.so
./build_android/src/out_android_x64/obj/libstellite_http_client.so
./build_android/src/out_android_armv7/obj/libstellite_http_client.so
./build_android/src/out_android_x86/obj/libstellite_http_client.so
./build_android/src/out_android_arm64/obj/libstellite_http_client.so
```

- Copy above files to cpp library directory of Android project.

```powershell
\MyStelliteTest\app\src\main\cpp\stellite\bin\armeabi-v7a\libstellite_http_client.so
```

## Copy jar files built from chromium

```bash
build_android/src/out_android_armv7/obj/lib.java/url/url_java.jar
build_android/src/out_android_armv7/obj/lib.java/third_party/jsr-305/jsr_305_javalib.jar
build_android/src/out_android_armv7/obj/lib.java/net/android/net_java.jar
build_android/src/out_android_armv7/obj/lib.java/base/base_java.jar
```

Copy above files to library directory of Android project

```powershell
\MyStelliteTest\app\libs\base_java.jar
\MyStelliteTest\app\libs\jsr_305_javalib.jar
\MyStelliteTest\app\libs\net_java.jar
\MyStelliteTest\app\libs\url_java.jar
```

## Write NDK build scripts

```powershell
\MyStelliteTest\app\build.gradle
\MyStelliteTest\app\Application.mk
\MyStelliteTest\app\Android.mk
```

## Write satellite initialization codes

```powershell
\MyStelliteTest\app\src\main\java\com\naver\videotech\mystellitetest\MainActivity.java
\MyStelliteTest\app\src\main\cpp\native-lib.cpp
```

## Write satellite quic request/response codes

```powershell
\MyStelliteTest\app\src\main\cpp\native-lib.cpp
\MyStelliteTest\app\src\main\cpp\MyStelliteHttpCallback.h
\MyStelliteTest\app\src\main\cpp\MyStelliteHttpCallback.cpp
```


## Check the results through logcat

```powershell
05-18 12:13:23.651 15085-15111/com.naver.videotech.mystellitetest D/MYSTELLITETEST: OnHttpResponse.OnHttpResponse request_id[1] body_len[45690] connection_info_desc[quic/1+spdy/3] connection_info[5]
    OnHttpResponse.OnHttpResponse body[<!doctype html><html itemscope="" itemtype="http://schema.org/WebPage" lang="ko"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type"><meta content="/images/branding/googleg/1x/googleg_standard_color_128dp.png" itemprop="image"><title>Google</title><script nonce="MKu1ZruEXteRHzSTE/12Xw==">(function(){window.google={kEI:'z0T-WpS2F4S10gT_kJr4BA',kEXPI:'0,1353747,57,472,639,258,588,1018,440,184,1218,76,617,12,15,68,204,12,2340437,278,149,32,329294,1294,12383,2349,2506,32691,2075,13173,867,1580,7,1369,7,3729,5471,11344,2985,2192,368,549,466,198,2102,113,729,1472,3191,726,5,336,1375,130,130,3742,1088,2,14,261,444,131,1119,2,579,663,64,311,592,294,867,367,126,624,355,257,284,14,90,789,1412,850,154,730,1188,429,479,38,7,151,1098,8,537,311,526,196,722,45,6,189,1043,485,79,457,216,62,2,345,122,373,503,912,199,336,27,8,428,351,331,526,18,375,154,37,140,827,155,106,438,612,140,35,28,83,27,18,64,87,108,668,54,15,1,164,69,161,5,243,2,116,30,301,33,56,535,617,371,31,4

05-18 12:13:29.363 15085-15111/com.naver.videotech.mystellitetest D/MYSTELLITETEST: OnHttpResponse.OnHttpResponse request_id[2] body_len[45690] connection_info_desc[quic/1+spdy/3] connection_info[5]
    OnHttpResponse.OnHttpResponse body[<!doctype html><html itemscope="" itemtype="http://schema.org/WebPage" lang="ko"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type"><meta content="/images/branding/googleg/1x/googleg_standard_color_128dp.png" itemprop="image"><title>Google</title><script nonce="b0QHCXPuVtSQNQ/2fLv82g==">(function(){window.google={kEI:'1UT-Wv3xB4Op0gTi2IfYBA',kEXPI:'0,1353747,57,472,639,258,588,1018,440,184,1218,76,617,12,15,68,204,12,2340437,278,149,32,329294,1294,12383,2349,2506,32691,2075,13173,867,1580,7,1369,7,3729,5471,11344,2985,2192,368,549,466,198,2102,113,729,1472,3191,726,5,336,1375,130,130,3742,1088,2,14,261,444,131,1119,2,579,663,64,311,592,294,867,367,126,624,355,257,284,14,90,789,1412,850,154,730,1188,429,479,38,7,151,1098,8,537,311,526,196,722,45,6,189,1043,485,79,457,216,62,2,345,122,373,503,912,199,336,27,8,428,351,331,526,18,375,154,37,140,827,155,106,438,612,140,35,28,83,27,18,64,87,108,668,54,15,1,164,69,161,5,243,2,116,30,301,33,56,535,617,371,31,4
```
